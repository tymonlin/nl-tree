!function(t){var e=t.module("module.newland.tree",[]);e.directive("nlTree",["$NLTree","$injector",function(c,e){return{restrict:"EA",scope:{data:"=",defaultToggled:"=",selected:"&",loadNodes:"&",dataKey:"@",nameKey:"@",multiSelect:"@",translateKey:"@",setConfig:"@",treeFlag:"@"},controller:["$scope",function(n){n.config=t.extend({},c.defaultConfig),n.setConfig&&t.extend(n.config,jQuery.parseJSON(n.setConfig)),n.nameKey||(n.nameKey="name"),n.dataKey||(n.dataKey="data"),null==n.multiSelect?n.multiSelect=n.config.defaultMultiSelect:"true"==n.multiSelect?n.multiSelect=!0:n.multiSelect=!1,n.fatherNodeCheck||(n.fatherNodeCheck=!1),null!=n.treeFlag&&"false"==n.treeFlag?n.showTree=!1:n.showTree=!0,n.translateKey&&e.has("$translate"),n.select=function(e){n.multiSelect?0==n.showTree&&n.check(e):e.active?(e.active=!1,n.selected({row:void 0}),n.selectedRow=void 0):(n.selectedRow&&(n.selectedRow.active=!1),e.active=!0,n.selected({row:e}),n.selectedRow=e)},n.check=function(e){e.checked=e.checked?0:2,0!=n.treeFlag&&(function e(t,a){t.checked=a;var o=t[n.dataKey];if(o)for(var l=0;l<o.length;l++){var c=o[l];e(c,a)}}(e,e.checked),c.recursiveState(n.data,n.dataKey))},n.changeToggled=function(e){var t;n.showTree&&(e.toggled||(t=n.loadNodes({row:e}))&&(e.data=t),e.toggled=!e.toggled)},n.initRowTOG=function(e){e.active&&(n.selectedRow&&(n.selectedRow.active=!1),n.selectedRow=e),e[n.dataKey]?e.toggled=null==e.toggled?null==n.defaultToggled?n.config.defaultToggled:n.defaultToggled:e.toggled:e.toggled=!1}}],template:"<div></div>",replace:!0,compile:function(e,t){for(var a=$(e),o=0;o<c.maxDepth;o++){var l=$("<ul ng-if='"+(0==o||"row"+(o-1)+"[dataKey]")+"'>   <li ng-repeat='row"+o+" in "+(0==o?"data":"row"+(o-1)+"[dataKey]")+"'        ng-class=\"{'active':(row"+o+".active), 'toggled': row"+o+".toggled}\"        ng-init='initRowTOG(row"+o+")'>       <i ng-if='showTree && row"+o+".treeNode!==false' ng-class=\"{true:config.toggledOpenIcon, false:config.toggledCloseIcon}[row"+o+".toggled == true]\" ng-click='changeToggled(row"+o+")'></i>       <i ng-show='multiSelect' ng-class=\"{'fa fa-square-o': !row"+o+".checked, 'fa fa-check-square-o': row"+o+".checked==2, 'fa fa-check-square': row"+o+".checked==1}\" ng-click='check(row"+o+")'></i>       <i ng-if='row"+o+".nodeIcon' class='{{row"+o+".nodeIcon}}'></i>       <a href='javascript:;' ng-click='select(row"+o+")' ng-dblclick='changeToggled(row"+o+")'><span>{{translateKey ? (row"+o+"[translateKey] | nlTreeTranslate) : row"+o+"[nameKey]}}</span></a>   </li></ul>");a.append(l),a=l.children("li")}}}}]),e.filter("nlTreeTranslate",["$NLTree","$injector",function(e,t){function a(e){return o?o.instant(e):e}var o=t.has("$translate")?t.get("$translate"):void 0;return a.$stateful=!0,a}]),e.provider("$NLTree",function e(){this.defaultConfig={toggledOpenIcon:"fa fa-minus-square-o",toggledCloseIcon:"fa fa-plus-square-o",defaultToggled:!1,defaultMultiSelect:!1},this.maxDepth=10,this.getCheckedList=function(e,t,a){t=t||"data";for(var o=[],l=0;l<e.length;l++){var c=e[l],n=[];c[t]&&(n=this.getCheckedList(c[t],t,a)),(!a&&!c[t]&&2==c.checked||a&&2==c.checked)&&o.push(c),o=o.concat(n)}return o},this.recursiveState=function(e,t){for(var a=0,o=0;o<e.length;o++){var l=e[o],c=l.checked;l[t]&&(c=this.recursiveState(l[t],t),l.checked=c),0==a&&0==o?a=c||0:(0==a&&2==c&&0<o||2==a&&!c||1==c)&&(a=1)}return a},this.sortDataList=function(e,t,a,o){for(var l=[],c=0;c<e.length;c++){var n,r=e[c];r[o]==t&&(0<(n=this.sortDataList(e,r[a],a,o)).length&&(r.data=n),l.push(r))}return l},this.$get=function(){return new e}})}(angular);
!function(t){var e=t.module("module.newland.tree",[]);e.directive("nlTree",["$NLTree","$injector",function(o,e){return{restrict:"EA",scope:{data:"=",defaultToggled:"=",selected:"&",loadNodes:"&",dataKey:"@",nameKey:"@",multiSelect:"@",translateKey:"@",setConfig:"@",treeFlag:"@"},controller:["$scope",function(n){n.config=t.extend({},o.defaultConfig),n.setConfig&&t.extend(n.config,jQuery.parseJSON(n.setConfig)),n.nameKey||(n.nameKey="name"),n.dataKey||(n.dataKey="data"),null==n.multiSelect?n.multiSelect=n.config.defaultMultiSelect:"true"==n.multiSelect?n.multiSelect=!0:n.multiSelect=!1,n.fatherNodeCheck||(n.fatherNodeCheck=!1),null!=n.treeFlag&&"false"==n.treeFlag?n.showTree=!1:n.showTree=!0,n.translateKey&&e.has("$translate"),n.select=function(e){n.multiSelect?0==n.showTree&&n.check(e):e.active?(e.active=!1,n.selected({row:void 0}),n.selectedRow=void 0):(n.selectedRow&&(n.selectedRow.active=!1),e.active=!0,n.selected({row:e}),n.selectedRow=e)},n.check=function(e){e.checked=e.checked?0:2,0!=n.treeFlag&&(function e(t,a){t.checked=a;var l=t[n.dataKey];if(l)for(var c=0;c<l.length;c++){var o=l[c];e(o,a)}}(e,e.checked),o.recursiveState(n.data,n.dataKey))},n.changeToggled=function(e){var t;n.showTree&&(e.toggled||(t=n.loadNodes({row:e}))&&(e.data=t),e.toggled=!e.toggled)},n.initRowTOG=function(e){e.active&&(n.selectedRow&&(n.selectedRow.active=!1),n.selectedRow=e),e[n.dataKey]?e.toggled=null==e.toggled?null==n.defaultToggled?n.config.defaultToggled:n.defaultToggled:e.toggled:e.toggled=!1}}],template:"<div></div>",replace:!0,compile:function(e,t){for(var a=$(e),l=0;l<o.maxDepth;l++){var c=$("<ul ng-if='"+(0==l||"row"+(l-1)+"[dataKey]")+"'>   <li ng-repeat='row"+l+" in "+(0==l?"data":"row"+(l-1)+"[dataKey]")+"'        ng-class=\"{'active':(row"+l+".active), 'toggled': row"+l+".toggled}\"        ng-init='initRowTOG(row"+l+")'>       <i ng-if='showTree' ng-class=\"{true:config.toggledOpenIcon, false:config.toggledCloseIcon}[row"+l+".toggled == true]\" ng-click='changeToggled(row"+l+")'></i>       <i ng-show='multiSelect' ng-class=\"{'fa fa-square-o': !row"+l+".checked, 'fa fa-check-square-o': row"+l+".checked==2, 'fa fa-check-square': row"+l+".checked==1}\" ng-click='check(row"+l+")'></i>       <a href='javascript:;' ng-click='select(row"+l+")' ng-dblclick='changeToggled(row"+l+")'><span>{{translateKey ? (row"+l+"[translateKey] | nlTreeTranslate) : row"+l+"[nameKey]}}</span></a>   </li></ul>");a.append(c),a=c.children("li")}}}}]),e.filter("nlTreeTranslate",["$NLTree","$injector",function(e,t){function a(e){return l?l.instant(e):e}var l=t.has("$translate")?t.get("$translate"):void 0;return a.$stateful=!0,a}]),e.provider("$NLTree",function e(){this.defaultConfig={toggledOpenIcon:"fa fa-minus-square-o",toggledCloseIcon:"fa fa-plus-square-o",defaultToggled:!1,defaultMultiSelect:!1},this.maxDepth=10,this.getCheckedList=function(e,t,a){t=t||"data";for(var l=[],c=0;c<e.length;c++){var o=e[c],n=[];o[t]&&(n=this.getCheckedList(o[t],t,a)),(!a&&!o[t]&&2==o.checked||a&&2==o.checked)&&l.push(o),l=l.concat(n)}return l},this.recursiveState=function(e,t){for(var a=0,l=0;l<e.length;l++){var c=e[l],o=c.checked;c[t]&&(o=this.recursiveState(c[t],t),c.checked=o),0==a&&0==l?a=o||0:(0==a&&2==o&&0<l||2==a&&!o||1==o)&&(a=1)}return a},this.sortDataList=function(e,t,a,l){for(var c=[],o=0;o<e.length;o++){var n,r=e[o];r[l]==t&&(0<(n=this.sortDataList(e,r[a],a,l)).length&&(r.data=n),c.push(r))}return c},this.$get=function(){return new e}})}(angular);
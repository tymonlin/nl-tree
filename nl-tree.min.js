!function(a){var e=a.module("module.newland.tree",[]);e.directive("nlTree",["$NLTree","$injector",function(c,e){return{restrict:"EA",scope:{data:"=",defaultToggled:"=",selectedRow:"@",selected:"&",loadNodes:"&",dataKey:"@",nameKey:"@",multiSelect:"@",translateKey:"@",setConfig:"@"},controller:["$scope",function(l){l.config=a.extend({},c.defaultConfig),l.setConfig&&a.extend(l.config,jQuery.parseJSON(l.setConfig)),l.nameKey||(l.nameKey="name"),l.dataKey||(l.dataKey="data"),l.multiSelect||(l.multiSelect=l.config.defaultMultiSelect),l.fatherNodeCheck||(l.fatherNodeCheck=!1),l.translateKey&&e.has("$translate"),l.select=function(e){e.active?(e.active=!1,l.selected({row:void 0}),l.selectedRow=void 0):(l.selectedRow&&(l.selectedRow.active=!1),e.active=!0,l.selected({row:e}),l.selectedRow=e)},l.check=function(e){e.checked=e.checked?0:2,function e(t,a){t.checked=a;var n=t[l.dataKey];if(n)for(var o=0;o<n.length;o++){var c=n[o];e(c,a)}}(e,e.checked),c.recursiveState(l.data,l.dataKey)},l.changeToggled=function(e){!e.toggled&&l.loadNodes&&(e.data=void 0,e.data=l.loadNodes({row:e})),e.toggled=!e.toggled};var t=l.defaultToggled;l.initRowTOG=function(e){e[l.dataKey]?e.toggled=null==e.toggled?null==t?l.config.defaultToggled:t:e.toggled:e.toggled=!1}}],template:"<div></div>",replace:!0,compile:function(e,t){for(var a=$(e),n=0;n<c.maxDepth;n++){var o=$("<ul ng-if='"+(0==n||"row"+(n-1)+"[dataKey]")+"'>   <li ng-repeat='row"+n+" in "+(0==n?"data":"row"+(n-1)+"[dataKey]")+"'        ng-class=\"{'active':(row"+n+".active), 'toggled': row"+n+".toggled}\"        ng-init='initRowTOG(row"+n+")'>       <i ng-class=\"{true:config.toggledOpenIcon, false:config.toggledCloseIcon}[row"+n+".toggled == true]\" ng-click='changeToggled(row"+n+")'></i>       <i ng-show='multiSelect' ng-class=\"{'fa fa-square-o': !row"+n+".checked, 'fa fa-check-square-o': row"+n+".checked==2, 'fa fa-check-square': row"+n+".checked==1}\" ng-click='check(row"+n+")'></i>       <a href='javascript:;' ng-click='select(row"+n+")' ng-dblclick='changeToggled(row"+n+")'><span>{{translateKey ? (row"+n+"[translateKey] | nlTreeTranslate) : row"+n+"[nameKey]}}</span></a>   </li></ul>");a.append(o),a=o.children("li")}}}}]),e.filter("nlTreeTranslate",["$NLTree","$injector",function(e,t){function a(e){return n?n.instant(e):e}var n=t.has("$translate")?t.get("$translate"):void 0;return a.$stateful=!0,a}]),e.provider("$NLTree",function e(){this.defaultConfig={toggledOpenIcon:"fa fa-minus-square-o",toggledCloseIcon:"fa fa-plus-square-o",defaultToggled:!1,defaultMultiSelect:!1},this.maxDepth=10,this.getCheckedList=function(e,t,a){t=t||"data";for(var n=[],o=0;o<e.length;o++){var c=e[o],l=[];c[t]&&(l=this.getCheckedList(c[t],t,a)),(!a&&!c[t]&&c.active||a&&c.active)&&n.push(c),n=n.concat(l)}return n},this.recursiveState=function(e,t){for(var a=0,n=0;n<e.length;n++){var o=e[n],c=o.checked;o[t]&&(c=this.recursiveState(o[t],t),o.checked=c),0==a&&0==n?a=c||0:(0==a&&2==c&&0<n||2==a&&!c||1==c)&&(a=1)}return a},this.sortDataList=function(e,t,a,n){for(var o=[],c=0;c<e.length;c++){var l,r=e[c];r[n]==t&&(0<(l=this.sortDataList(e,r[a],a,n)).length&&(r.data=l),o.push(r))}return o},this.$get=function(){return new e}})}(angular);